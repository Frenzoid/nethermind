name: Hive consensus tests

on:
  push:
    branches: [test/hive-consensus]
    tags: ['*']
  workflow_dispatch:
    inputs:
      parallelism:
        description: 'Number of concurrently running tests in each job. With 1 or 2 timeout is likely. With 4 or more false-positive fails are likely. Recommended is 3 to avoid timeouts and reduce false-positives'
        required: true
        default: '3'
        type: choice
        options: ['1', '2', '3', '4', '8', '16']

#env:
#  DOTNET_SYSTEM_CONSOLE_ALLOW_ANSI_COLOR_REDIRECTION: 1
#  TERM: xterm

jobs:
  test:
    name: Build and run tests
    runs-on: ubuntu-latest
    strategy:
      matrix:
        limit:
          #1
          - stArgsZeroOneBalance
          - stAttackTest
          - badOpcodes
          - eip2315NotRemoved
          - invalidAddr
          - invalidDiffPlaces
          - measureGas
          #2
          - opc0CDiffPlaces
          - opc0DDiffPlaces
          - opc0EDiffPlaces
          - opc0FDiffPlaces
          - opc1EDiffPlaces
          - opc1FDiffPlaces
          - opc21DiffPlaces
          - opc22DiffPlaces
          #3
          - opc23DiffPlaces
          - opc24DiffPlaces
          - opc25DiffPlaces
          - opc26DiffPlaces
          - opc27DiffPlaces
          - opc28DiffPlaces
          - opc29DiffPlaces
          - opc2ADiffPlaces
          #4
          - opc2BDiffPlaces
          - opc2CDiffPlaces
          - opc2DDiffPlaces
          - opc2EDiffPlaces
          - opc2FDiffPlaces
          - opc49DiffPlaces
          - opc4ADiffPlaces
          - opc4BDiffPlaces
          #5
          - opc4CDiffPlaces
          - opc4DDiffPlaces
          - opc4EDiffPlaces
          - opc4FDiffPlaces
          - opc5CDiffPlaces
          - opc5DDiffPlaces
          - opc5EDiffPlaces
          - opc5FDiffPlaces
          #6
          - opcA5DiffPlaces
          - opcA6DiffPlaces
          - opcA7DiffPlaces
          - opcA8DiffPlaces
          - opcA9DiffPlaces
          - opcAADiffPlaces
          - opcABDiffPlaces
          - opcACDiffPlaces
          #7
          - opcADDiffPlaces
          - opcAEDiffPlaces
          - opcAFDiffPlaces
          - opcB0DiffPlaces
          - opcB1DiffPlaces
          - opcB2DiffPlaces
          - opcB3DiffPlaces
          - opcB4DiffPlaces
          #8
          - opcB5DiffPlaces
          - opcB6DiffPlaces
          - opcB7DiffPlaces
          - opcB8DiffPlaces
          - opcB9DiffPlaces
          - opcBADiffPlaces
          - opcBBDiffPlaces
          - opcBCDiffPlaces
          #9
          - opcBDDiffPlaces
          - opcBEDiffPlaces
          - opcBFDiffPlaces
          - opcC0DiffPlaces
          - opcC1DiffPlaces
          - opcC2DiffPlaces
          - opcC3DiffPlaces
          - opcC4DiffPlaces
          #10
          - opcC5DiffPlaces
          - opcC6DiffPlaces
          - opcC7DiffPlaces
          - opcC8DiffPlaces
          - opcC9DiffPlaces
          - opcCADiffPlaces
          - opcCBDiffPlaces
          - opcCCDiffPlaces
          #11
          - opcCDDiffPlaces
          - opcCEDiffPlaces
          - opcCFDiffPlaces
          - opcD0DiffPlaces
          - opcD1DiffPlaces
          - opcD2DiffPlaces
          - opcD3DiffPlaces
          - opcD4DiffPlaces
          #12
          - opcD5DiffPlaces
          - opcD6DiffPlaces
          - opcD7DiffPlaces
          - opcD8DiffPlaces
          - opcD9DiffPlaces
          - opcDADiffPlaces
          - opcDBDiffPlaces
          - opcDCDiffPlaces
          #13
          - opcDDDiffPlaces
          - opcDEDiffPlaces
          - opcDFDiffPlaces
          - opcE0DiffPlaces
          - opcE1DiffPlaces
          - opcE2DiffPlaces
          - opcE3DiffPlaces
          - opcE4DiffPlaces
          #14
          - opcE5DiffPlaces
          - opcE6DiffPlaces
          - opcE7DiffPlaces
          - opcE8DiffPlaces
          - opcE9DiffPlaces
          - opcEADiffPlaces
          - opcEBDiffPlaces
          - opcECDiffPlaces
          #15
          - opcEDDiffPlaces
          - opcEEDiffPlaces
          - opcEFDiffPlaces
          - opcF6DiffPlaces
          - opcF7DiffPlaces
          - opcF8DiffPlaces
          - opcF9DiffPlaces
          - opcFBDiffPlaces
          #16
          - opcFCDiffPlaces
          - opcFEDiffPlaces
          - operationDiffGas
          - undefinedOpcodeFirstByte
          - stBugs
          - stCallCodes
          - stCallCreateCallCodeTest
          - stCallDelegateCodesCallCodeHomestead
          - stCallDelegateCodesHomestead
          #17
          - stChainId
          - stCodeCopyTest 
          - stCodeSizeLimit
          - stCreate2
          #18
          - stCreateTest
          - stDelegatecallTestHomestead
          #19
          - stEIP150singleCodeGasPrices
          - stEIP150Specific
          #20
          - intrinsic
          #21
          - baseFeeDiffPlaces
          - gasPriceDiffPlaces
          - lowFeeCap
          - lowGasLimit
          - lowGasPriceOldTypes
          - outOfFunds
          - outOfFundsOldTypes
          - senderBalance
          - tipTooHigh
          - transactionIntinsicBug
          - typeTwoBerlin
          - valCausesOOF
          - stEIP158Specific
          - stEIP2930
          - stEIP3607
          - stExample
          #22
          - buffer
          #23
          - stExtCodeHash
          - stHomesteadSpecific
          - stInitCodeTest
          - stLogTests
          - stMemExpandingEIP150Calls
          - stMemoryStressTest
          - bufferSrcOffset
          - callDataCopyOffset
          - calldatacopy_dejavu
          - calldatacopy_dejavu2
          #24
          - codeCopyOffset
          - codecopy_dejavu
          - codecopy_dejavu2
          - extcodecopy_dejavu
          - log1_dejavu
          - log2_dejavu
          - log3_dejavu
          - log4_dejavu
          - mem0b_singleByte
          - mem31b_singleByte
          - mem32b_singleByte
          - mem32kb+1
          - mem32kb+31
          - mem32kb+32
          - mem32kb+33
          - mem32kb-1
          - mem32kb-31
          - mem32kb-32
          - mem32kb-33
          - mem32kb
          - mem32kb_singleByte+1
          - mem32kb_singleByte+31
          - mem32kb_singleByte+32
          - mem32kb_singleByte+33
          - mem32kb_singleByte-1
          - mem32kb_singleByte-31
          - mem32kb_singleByte-32
          - mem32kb_singleByte-33
          - mem32kb_singleByte
          - mem33b_singleByte
          - mem64kb+1
          - mem64kb+31
          - mem64kb+32
          - mem64kb+33
          - mem64kb-1
          - mem64kb-31
          - mem64kb-32
          - mem64kb-33
          - mem64kb
          - mem64kb_singleByte+1
          - mem64kb_singleByte+31
          - mem64kb_singleByte+32
          - mem64kb_singleByte+33
          - mem64kb_singleByte-1
          - mem64kb_singleByte-31
          - mem64kb_singleByte-32
          - mem64kb_singleByte-33
          - mem64kb_singleByte
          - memCopySelf
          - memReturn
          - mload16bitBound
          - mload8bitBound
          - mload_dejavu
          - mstore_dejavu
          - mstroe8_dejavu
          - oog
          - sha3_dejavu
          #25
          - stackLimitGas_1023
          - stackLimitGas_1024
          - stackLimitGas_1025
          - stackLimitPush31_1023
          - stackLimitPush31_1024
          - stackLimitPush31_1025
          - stackLimitPush32_1023
          - stackLimitPush32_1024
          - stackLimitPush32_1025
          - stNonZeroCallsTest
          - blake2B
          - delegatecall09Undefined
          - identity_to_bigger
          - identity_to_smaller
          - idPrecomps
          #26
          - precompsEIP2929
          #27
          - modexp
          - modexpTests
          - sec80
          #28
          - stPreCompiledContracts2
          - stQuadraticComplexityTest
          #29
          - stRandom
          #30
          - stRandom2
          - stRecursiveCreate
          - stRefundTest
          #31
          - stReturnDataTest
          #32
          - stRevertTest
          - stSelfBalance
          #33
          - stSStoreTest
          #34
          - stShift
          - stSLoadTest
          - stSolidityTest
          - stSpecialTest
          - shallowStack
          - stackOverflow
          - stackOverflowDUP --si
          - stackOverflowM1
          - stackOverflowM1DUP --
          #35
          - stackOverflowM1PUSH
          #36
          - underflowTest
          #37
          - stackOverflowPUSH
          - stackOverflowSWAP
          - stacksanitySWAP
          - StaticcallToPrecompileFromCalledContract
          - StaticcallToPrecompileFromContractInitialization
          - StaticcallToPrecompileFromTransaction
          - static_ABAcalls0
          - static_ABAcalls1
          - static_ABAcalls2
          - static_ABAcalls3
          - static_ABAcallsSuicide0
          - static_ABAcallsSuicide1
          - static_Call10
          - static_Call1024BalanceTooLow
          - static_Call1024BalanceTooLow2
          - static_Call1024OOG
          - static_Call1024PreCalls
          - static_Call1024PreCalls2
          - static_Call1024PreCalls3
          - static_Call1MB1024Calldepth
          - static_Call50000
          #38
          - static_Call50000bytesContract50_1
          - static_Call50000bytesContract50_2
          - static_Call50000bytesContract50_3
          - static_Call50000_ecrec
          - static_Call50000_identity
          - static_Call50000_identity2
          - static_Call50000_rip160
          - static_CallAndCallcodeConsumeMoreGasThenTransactionHas
          - static_CallAskMoreGasOnDepth2ThenTransactionHas
          - static_callBasic
          - static_callcallcallcode_001
          - static_callcallcallcode_001_2
          - static_callcallcallcode_001_OOGE
          - static_callcallcallcode_001_OOGE_2
          - static_callcallcallcode_001_OOGMAfter
          - static_callcallcallcode_001_OOGMAfter2
          - static_callcallcallcode_001_OOGMAfter_2
          - static_callcallcallcode_001_OOGMAfter_3
          - static_callcallcallcode_001_OOGMBefore
          - static_callcallcallcode_001_OOGMBefore2
          - static_callcallcallcode_001_SuicideEnd
          #39
          - static_callcallcallcode_001_SuicideEnd2
          - static_callcallcallcode_001_SuicideMiddle
          - static_callcallcallcode_001_SuicideMiddle2
          - static_callcallcallcode_ABCB_RECURSIVE
          - static_callcallcallcode_ABCB_RECURSIVE2
          - static_callcallcall_000
          - static_callcallcall_000_OOGE
          - static_callcallcall_000_OOGMAfter
          - static_callcallcall_000_OOGMAfter2
          - static_callcallcall_000_OOGMBefore
          - static_callcallcall_000_SuicideEnd
          - static_callcallcall_000_SuicideMiddle
          - static_callcallcall_ABCB_RECURSIVE
          - static_callcallcodecallcode_011
          - static_callcallcodecallcode_011_2
          - static_callcallcodecallcode_011_OOGE
          - static_callcallcodecallcode_011_OOGE_2
          - static_callcallcodecallcode_011_OOGMAfter
          - static_callcallcodecallcode_011_OOGMAfter2
          - static_callcallcodecallcode_011_OOGMAfter_1
          - static_callcallcodecallcode_011_OOGMAfter_2
          - static_callcallcodecallcode_011_OOGMBefore
          - static_callcallcodecallcode_011_OOGMBefore2
          - static_callcallcodecallcode_011_SuicideEnd
          - static_callcallcodecallcode_011_SuicideEnd2
          - static_callcallcodecallcode_011_SuicideMiddle
          - static_callcallcodecallcode_011_SuicideMiddle2
          - static_callcallcodecallcode_ABCB_RECURSIVE
          - static_callcallcodecallcode_ABCB_RECURSIVE2
          - static_callcallcodecall_010
          - static_callcallcodecall_010_2
          - static_callcallcodecall_010_OOGE
          - static_callcallcodecall_010_OOGE_2
          - static_callcallcodecall_010_OOGMAfter
          - static_callcallcodecall_010_OOGMAfter2
          - static_callcallcodecall_010_OOGMAfter_2
          - static_callcallcodecall_010_OOGMAfter_3
          - static_callcallcodecall_010_OOGMBefore
          - static_callcallcodecall_010_OOGMBefore2
          - static_callcallcodecall_010_SuicideEnd
          - static_callcallcodecall_010_SuicideEnd2
          - static_callcallcodecall_010_SuicideMiddle
          - static_callcallcodecall_010_SuicideMiddle2
          - static_callcallcodecall_ABCB_RECURSIVE
          - static_callcallcodecall_ABCB_RECURSIVE2
          - static_callcallcode_01_2
          - static_callcallcode_01_OOGE_2
          - static_callcallcode_01_SuicideEnd
          - static_callcallcode_01_SuicideEnd2
          - static_callcall_00
          - static_callcall_00_OOGE
          - static_callcall_00_OOGE_1
          - static_callcall_00_OOGE_2
          - static_callcall_00_SuicideEnd
          - static_callChangeRevert
          - static_callcodecallcallcode_101
          - static_callcodecallcallcode_101_2
          - static_callcodecallcallcode_101_OOGE
          - static_callcodecallcallcode_101_OOGE_2
          - static_callcodecallcallcode_101_OOGMAfter
          #40
          - static_callcodecallcallcode_101_OOGMAfter2
          - static_callcodecallcallcode_101_OOGMAfter_1
          - static_callcodecallcallcode_101_OOGMAfter_3
          - static_callcodecallcallcode_101_OOGMBefore
          - static_callcodecallcallcode_101_OOGMBefore2
          - static_callcodecallcallcode_101_SuicideEnd
          - static_callcodecallcallcode_101_SuicideEnd2
          - static_callcodecallcallcode_101_SuicideMiddle
          - static_callcodecallcallcode_101_SuicideMiddle2
          - static_callcodecallcallcode_ABCB_RECURSIVE
          - static_callcodecallcallcode_ABCB_RECURSIVE2
          - static_callcodecallcall_100
          - static_callcodecallcall_100_2
          - static_callcodecallcall_100_OOGE
          - static_callcodecallcall_100_OOGE2
          - static_callcodecallcall_100_OOGMAfter
          - static_callcodecallcall_100_OOGMAfter2
          - static_callcodecallcall_100_OOGMAfter_2
          - static_callcodecallcall_100_OOGMAfter_3
          - static_callcodecallcall_100_OOGMBefore
          - static_callcodecallcall_100_OOGMBefore2
          - static_callcodecallcall_100_SuicideEnd
          - static_callcodecallcall_100_SuicideEnd2
          - static_callcodecallcall_100_SuicideMiddle
          - static_callcodecallcall_100_SuicideMiddle2
          - static_callcodecallcall_ABCB_RECURSIVE
          - static_callcodecallcall_ABCB_RECURSIVE2
          - static_callcodecallcodecallcode_111_SuicideEnd
          - static_callcodecallcodecall_110
          - static_callcodecallcodecall_1102
          - static_callcodecallcodecall_110_2
          - static_callcodecallcodecall_110_OOGE
          - static_callcodecallcodecall_110_OOGE2
          - static_callcodecallcodecall_110_OOGMAfter
          - static_callcodecallcodecall_110_OOGMAfter2
          - static_callcodecallcodecall_110_OOGMAfter_2
          - static_callcodecallcodecall_110_OOGMAfter_3
          - static_callcodecallcodecall_110_OOGMBefore
          - static_callcodecallcodecall_110_OOGMBefore2
          - static_callcodecallcodecall_110_SuicideEnd
          - static_callcodecallcodecall_110_SuicideEnd2
          - static_callcodecallcodecall_110_SuicideMiddle
          - static_callcodecallcodecall_110_SuicideMiddle2
          - static_callcodecallcodecall_ABCB_RECURSIVE
          - static_callcodecallcodecall_ABCB_RECURSIVE2
          - static_callcodecall_10
          - static_callcodecall_10_2
          - static_callcodecall_10_OOGE
          - static_callcodecall_10_OOGE_2
          - static_callcodecall_10_SuicideEnd
          - static_callcodecall_10_SuicideEnd2
          - static_callcode_checkPC
          - static_CallContractToCreateContractAndCallItOOG
          - static_CallContractToCreateContractOOG
          - static_CallContractToCreateContractOOGBonusGas
          - static_CallContractToCreateContractWhichWouldCreateContractIfCalled
          - static_callCreate
          - static_callCreate2
          #41
          - static_callCreate3
          - static_calldelcode_01
          - static_calldelcode_01_OOGE
          - static_CallEcrecover0
          - static_CallEcrecover0_0input
          - static_CallEcrecover0_completeReturnValue
          - static_CallEcrecover0_Gas2999
          - static_CallEcrecover0_gas3000
          - static_CallEcrecover0_NoGas
          - static_CallEcrecover0_overlappingInputOutput
          - static_CallEcrecover1
          - static_CallEcrecover2
          - static_CallEcrecover3
          - static_CallEcrecover80
          - static_CallEcrecoverCheckLength
          - static_CallEcrecoverCheckLengthWrongV
          - static_CallEcrecoverH_prefixed0
          - static_CallEcrecoverR_prefixed0
          - static_CallEcrecoverS_prefixed0
          - static_CallEcrecoverV_prefixed0
          - static_CallGoesOOGOnSecondLevel
          - static_CallGoesOOGOnSecondLevel2
          - static_CallIdentitiy_1
          - static_CallIdentity_1_nonzeroValue
          - static_CallIdentity_2
          - static_CallIdentity_3
          - static_CallIdentity_4
          - static_CallIdentity_4_gas17
          - static_CallIdentity_4_gas18
          - static_CallIdentity_5
          - static_CallLoseGasOOG
          - static_callOutput1
          - static_callOutput2
          - static_callOutput3
          - static_callOutput3Fail
          - static_callOutput3partial
          - static_callOutput3partialFail
          - static_CallRecursiveBomb0
          - static_CallRecursiveBomb0_OOG_atMaxCallDepth
          - static_CallRecursiveBomb1
          - static_CallRecursiveBomb2
          - static_CallRecursiveBomb3
          - static_CallRecursiveBombLog
          - static_CallRecursiveBombLog2
          - static_CallRecursiveBombPreCall
          - static_CallRecursiveBombPreCall2
          - static_CallRipemd160_1
          - static_CallRipemd160_2
          - static_CallRipemd160_3
          - static_CallRipemd160_3_postfixed0
          - static_CallRipemd160_3_prefixed0
          - static_CallRipemd160_4
          - static_CallRipemd160_4_gas719
          - static_CallRipemd160_5
          - static_CallSha256_1
          - static_CallSha256_1_nonzeroValue
          - static_CallSha256_2
          - static_CallSha256_3
          - static_CallSha256_3_postfix0
          - static_CallSha256_3_prefix0
          - static_CallSha256_4
          - static_CallSha256_4_gas99
          - static_CallSha256_5
          - static_callToCallCodeOpCodeCheck
          - static_callToCallOpCodeCheck
          #42
          - static_callToDelCallOpCodeCheck
          - static_CallToNameRegistrator0
          - static_CallToReturn1
          - static_CalltoReturn2
          - static_callToStaticOpCodeCheck
          - static_callWithHighValue
          - static_callWithHighValueAndGasOOG
          - static_callWithHighValueAndOOGatTxLevel
          - static_callWithHighValueOOGinCall
          - static_CALL_OneVCallSuicide
          - static_call_OOG_additionalGasCosts1
          - static_call_OOG_additionalGasCosts2
          - static_call_value_inherit
          - static_call_value_inherit_from_call
          - static_CALL_ZeroVCallSuicide
          - static_CheckCallCostOOG
          - static_CheckOpcodes
          - static_CheckOpcodes2
          - static_CheckOpcodes3
          - static_CheckOpcodes4
          - static_CheckOpcodes5
          - static_contractCreationMakeCallThatAskMoreGasThenTransactionProvided
          - static_contractCreationOOGdontLeaveEmptyContractViaTransaction
          - static_CREATE_ContractSuicideDuringInit
          - static_CREATE_ContractSuicideDuringInit_ThenStoreThenReturn
          - static_CREATE_ContractSuicideDuringInit_WithValue
          - static_CREATE_EmptyContractAndCallIt_0wei
          - static_CREATE_EmptyContractWithStorageAndCallIt_0wei
          - static_ExecuteCallThatAskForeGasThenTrabsactionHas
          - static_InternalCallHittingGasLimit
          - static_InternalCallHittingGasLimit2
          - static_InternlCallStoreClearsOOG
          - static_log0_emptyMem
          - static_log0_logMemsizeTooHigh
          - static_log0_logMemsizeZero
          - static_log0_logMemStartTooHigh
          - static_log0_nonEmptyMem
          - static_log0_nonEmptyMem_logMemSize1
          - static_log0_nonEmptyMem_logMemSize1_logMemStart31
          - static_log1_emptyMem
          - static_log1_logMemsizeTooHigh
          - static_log1_logMemsizeZero
          - static_log1_logMemStartTooHigh
          - static_log1_MaxTopic
          - static_log_Caller
          - static_LoopCallsDepthThenRevert
          - static_LoopCallsDepthThenRevert2
          - static_LoopCallsDepthThenRevert3
          - static_LoopCallsThenRevert
          - static_makeMoney
          - static_PostToReturn1
          - static_RawCallGasAsk
          #43
          - sstore_combinations_initial00
          #44
          - sstore_combinations_initial00_2
          #45
          - sstore_combinations_initial01
          #46
          - sstore_combinations_initial01_2
          #47
          - sstore_combinations_initial10
          #48
          - sstore_combinations_initial10_2
          #49
          - sstore_combinations_initial11
          #50
          - sstore_combinations_initial11_2
          #51
          - sstore_combinations_initial20
          #52
          - sstore_combinations_initial20_2
          #53
          - sstore_combinations_initial21
          #54
          - sstore_combinations_initial21_2
          #55
          - static_refund_CallA
          - static_refund_CallToSuicideNoStorage
          - static_refund_CallToSuicideTwice
          - static_Return50000_2
          - static_ReturnTest
          - static_ReturnTest2
          - static_RETURN_Bounds
          - static_RETURN_BoundsOOG
          - static_RevertDepth2
          - static_RevertOpcodeCalls
          - static_ZeroValue_CALL_OOGRevert
          - static_ZeroValue_SUICIDE_OOGRevert
          - stStaticFlagEnabled
          - stSystemOperationsTest
          - CALLBlake2f_MaxRounds
          - static_Call50000_sha256
          - stTransactionTest
          - stTransitionTest
          #56
          - stWalletTest
          - stZeroCallsRevert
          - stZeroCallsTest
          - ecmul_1-2_2_28000_128
          - ecmul_1-2_2_28000_96
          - ecmul_1-2_340282366920938463463374607431768211456_21000_128
          - ecmul_1-2_340282366920938463463374607431768211456_21000_80
          - ecmul_1-2_340282366920938463463374607431768211456_21000_96
          - ecmul_1-2_340282366920938463463374607431768211456_28000_128
          - ecmul_1-2_340282366920938463463374607431768211456_28000_80
          - ecmul_1-2_340282366920938463463374607431768211456_28000_96
          - ecmul_1-2_5616_21000_128
          - ecmul_1-2_5616_21000_96
          - ecmul_1-2_5616_28000_128
          - ecmul_1-2_5617_21000_128
          - ecmul_1-2_5617_21000_96
          - ecmul_1-2_5617_28000_128
          - ecmul_1-2_5617_28000_96
          - ecmul_1-2_616_28000_96
          - ecmul_1-2_9935_21000_128
          - ecmul_1-2_9935_21000_96
          - ecmul_1-2_9935_28000_128
          - ecmul_1-2_9935_28000_96
          - ecmul_1-2_9_21000_128
          - ecmul_1-2_9_21000_96
          #57
          - ecmul_1-2_9_28000_128
          - ecmul_1-2_9_28000_96
          - ecmul_1-3_0_21000_128
          - ecmul_1-3_0_21000_64
          - ecmul_1-3_0_21000_80
          - ecmul_1-3_0_21000_96
          - ecmul_1-3_0_28000_128
          - ecmul_1-3_0_28000_64
          - ecmul_1-3_0_28000_80
          - ecmul_1-3_0_28000_96
          - ecmul_1-3_1_21000_128
          - ecmul_1-3_1_21000_96
          - ecmul_1-3_1_28000_128
          - ecmul_1-3_1_28000_96
          - ecmul_1-3_2_21000_128
          - ecmul_1-3_2_21000_96
          - ecmul_1-3_2_28000_128
          - ecmul_1-3_2_28000_96
          - ecmul_1-3_340282366920938463463374607431768211456_21000_128
          - ecmul_1-3_340282366920938463463374607431768211456_21000_80
          - ecmul_1-3_340282366920938463463374607431768211456_21000_96
          - ecmul_1-3_340282366920938463463374607431768211456_28000_128
          - ecmul_1-3_340282366920938463463374607431768211456_28000_80
          - ecmul_1-3_340282366920938463463374607431768211456_28000_96
          - ecmul_1-3_5616_21000_128
          - ecmul_1-3_5616_21000_96
          - ecmul_1-3_5616_28000_128
          - ecmul_1-3_5616_28000_96
          - ecmul_1-3_5617_21000_128
          - ecmul_1-3_5617_21000_96
          - ecmul_1-3_5617_28000_128
          - ecmul_1-3_5617_28000_96
          - ecmul_1-3_9935_21000_128
          #58
          - ecmul_1-3_9935_21000_96
          - ecmul_1-3_9935_28000_128
          - ecmul_1-3_9935_28000_96
          - ecmul_1-3_9_21000_128
          - ecmul_1-3_9_21000_96
          - ecmul_1-3_9_28000_128
          - ecmul_1-3_9_28000_96
          - ecmul_7827-6598_0_21000_128
          - ecmul_7827-6598_0_21000_64
          - ecmul_7827-6598_0_21000_80
          - ecmul_7827-6598_0_21000_96
          - ecmul_7827-6598_0_28000_128
          - ecmul_7827-6598_0_28000_64
          - ecmul_7827-6598_0_28000_80
          - ecmul_7827-6598_0_28000_96
          - ecmul_7827-6598_1456_21000_128
          - ecmul_7827-6598_1456_21000_80
          - ecmul_7827-6598_1456_21000_96
          - ecmul_7827-6598_1456_28000_128
          - ecmul_7827-6598_1456_28000_80
          - ecmul_7827-6598_1456_28000_96
          - ecmul_7827-6598_1_21000_128
          - ecmul_7827-6598_1_21000_96
          - ecmul_7827-6598_1_28000_128
          - ecmul_7827-6598_1_28000_96
          - ecmul_7827-6598_2_21000_128
          - ecmul_7827-6598_2_21000_96
          - ecmul_7827-6598_2_28000_128
          - ecmul_7827-6598_2_28000_96
          - ecmul_7827-6598_5616_21000_128
          - ecmul_7827-6598_5616_21000_96
          - ecmul_7827-6598_5616_28000_128
          - ecmul_7827-6598_5616_28000_96
          #59
          - ecmul_7827-6598_5617_21000_128
          - ecmul_7827-6598_5617_21000_96
          - ecmul_7827-6598_5617_28000_128
          - ecmul_7827-6598_5617_28000_96
          - ecmul_7827-6598_9935_21000_128
          - ecmul_7827-6598_9935_21000_96
          - ecmul_7827-6598_9935_28000_128
          - ecmul_7827-6598_9935_28000_96
          - ecmul_7827-6598_9_21000_128
          - ecmul_7827-6598_9_21000_96
          - ecmul_7827-6598_9_28000_128
          - ecmul_7827-6598_9_28000_96
          - ecpairing_bad_length_191
          - ecpairing_bad_length_193
          - ecpairing_empty_data
          - ecpairing_empty_data_insufficient_gas
          - ecpairing_one_point_fail
          - ecpairing_one_point_insufficient_gas
          - ecpairing_one_point_not_in_subgroup
          - ecpairing_one_point_with_g1_zero
          - ecpairing_one_point_with_g2_zero
          - ecpairing_one_point_with_g2_zero_and_g1_invalid
          - ecpairing_perturb_g2_by_curve_order
          - ecpairing_perturb_g2_by_field_modulus
          - ecpairing_perturb_g2_by_field_modulus_again
          - ecpairing_perturb_g2_by_one
          - ecpairing_perturb_zeropoint_by_curve_order
          - ecpairing_perturb_zeropoint_by_field_modulus
          - ecpairing_perturb_zeropoint_by_one
          - ecpairing_three_point_fail_1
          - ecpairing_three_point_match_1
          - ecpairing_two_points_with_one_g2_zero
          - ecpairing_two_point_fail_1
          - ecpairing_two_point_fail_2
          #60
          - ecpairing_two_point_match_1
          - ecpairing_two_point_match_2
          - ecpairing_two_point_match_3
          - ecpairing_two_point_match_4
          - ecpairing_two_point_match_5
          - ecpairing_two_point_oog
          - pairingTest
          - pointAdd
          - pointAddTrunc
          - pointMulAdd
          - pointMulAdd2
          - ecadd_0-0_0-0_21000_0
          - ecadd_0-0_0-0_21000_128
          - ecadd_0-0_0-0_21000_192
          #61
          - ecadd_0-0_0-0_21000_64
          - ecadd_0-0_0-0_21000_80
          - ecadd_0-0_0-0_25000_0
          - ecadd_0-0_0-0_25000_128
          - ecadd_0-0_0-0_25000_192
          - ecadd_0-0_0-0_25000_64
          - ecadd_0-0_0-0_25000_80
          - ecadd_0-0_1-2_21000_128
          - ecadd_0-0_1-2_21000_192
          - ecadd_0-0_1-2_25000_128
          - ecadd_0-0_1-2_25000_192
          - ecadd_0-0_1-3_21000_128
          - ecadd_0-0_1-3_25000_128
          - ecadd_0-3_1-2_21000_128
          - ecadd_0-3_1-2_25000_128
          - ecadd_1-2_0-0_21000_128
          - ecadd_1-2_0-0_21000_192
          - ecadd_1-2_0-0_21000_64
          - ecadd_1-2_0-0_25000_128
          - ecadd_1-2_0-0_25000_192
          - ecadd_1-2_0-0_25000_64
          - ecadd_1-2_1-2_21000_128
          - ecadd_1-2_1-2_21000_192
          - ecadd_1-2_1-2_25000_128
          - ecadd_1-2_1-2_25000_192
          - ecadd_1-3_0-0_21000_80
          - ecadd_1-3_0-0_25000_80
          - ecadd_1145-3932_1145-4651_21000_192
          - ecadd_1145-3932_1145-4651_25000_192
          - ecadd_1145-3932_2969-1336_21000_128
          - ecadd_1145-3932_2969-1336_25000_128
          - ecadd_6-9_19274124-124124_21000_128
          - ecadd_6-9_19274124-124124_25000_128
          #62
          - ecmul_0-0_0_21000_0
          - ecmul_0-0_0_21000_128
          - ecmul_0-0_0_21000_40
          - ecmul_0-0_0_21000_64
          - ecmul_0-0_0_21000_80
          - ecmul_0-0_0_21000_96
          - ecmul_0-0_0_28000_0
          - ecmul_0-0_0_28000_128
          - ecmul_0-0_0_28000_40
          - ecmul_0-0_0_28000_64
          - ecmul_0-0_0_28000_80
          - ecmul_0-0_0_28000_96
          - ecmul_0-0_1_21000_128
          - ecmul_0-0_1_21000_96
          - ecmul_0-0_1_28000_128
          - ecmul_0-0_1_28000_96
          - ecmul_0-0_2_21000_128
          - ecmul_0-0_2_21000_96
          - ecmul_0-0_2_28000_128
          - ecmul_0-0_2_28000_96
          - ecmul_0-0_340282366920938463463374607431768211456_21000_128
          - ecmul_0-0_340282366920938463463374607431768211456_21000_80
          - ecmul_0-0_340282366920938463463374607431768211456_21000_96
          - ecmul_0-0_340282366920938463463374607431768211456_28000_128
          - ecmul_0-0_340282366920938463463374607431768211456_28000_80
          - ecmul_0-0_340282366920938463463374607431768211456_28000_96
          - ecmul_0-0_5616_21000_128
          - ecmul_0-0_5616_21000_96
          - ecmul_0-0_5616_28000_128
          - ecmul_0-0_5616_28000_96
          - ecmul_0-0_5617_21000_128
          - ecmul_0-0_5617_21000_96
          - ecmul_0-0_5617_28000_128
          #63
          - ecmul_0-0_5617_28000_96
          - ecmul_0-0_9935_21000_128
          - ecmul_0-0_9935_21000_96
          - ecmul_0-0_9935_28000_128
          - ecmul_0-0_9935_28000_96
          - ecmul_0-0_9_21000_128
          - ecmul_0-0_9_21000_96
          - ecmul_0-0_9_28000_128
          - ecmul_0-0_9_28000_96
          - ecmul_0-3_0_21000_128
          - ecmul_0-3_0_21000_64
          - ecmul_0-3_0_21000_80
          - ecmul_0-3_0_21000_96
          - ecmul_0-3_0_28000_128
          - ecmul_0-3_0_28000_64
          - ecmul_0-3_0_28000_80
          - ecmul_0-3_0_28000_96
          - ecmul_0-3_1_21000_128
          - ecmul_0-3_1_21000_96
          - ecmul_0-3_1_28000_128
          - ecmul_0-3_1_28000_96
          - ecmul_0-3_2_21000_128
          - ecmul_0-3_2_21000_96
          - ecmul_0-3_2_28000_128
          - ecmul_0-3_2_28000_96
          - ecmul_0-3_340282366920938463463374607431768211456_21000_128
          - ecmul_0-3_340282366920938463463374607431768211456_21000_80
          - ecmul_0-3_340282366920938463463374607431768211456_21000_96
          - ecmul_0-3_340282366920938463463374607431768211456_28000_128
          - ecmul_0-3_340282366920938463463374607431768211456_28000_80
          - ecmul_0-3_340282366920938463463374607431768211456_28000_96
          - ecmul_0-3_5616_21000_128
          - ecmul_0-3_5616_21000_96
          #64
          - ecmul_0-3_5616_28000_128
          - ecmul_0-3_5616_28000_96
          - ecmul_0-3_5617_21000_128
          - ecmul_0-3_5617_21000_96
          - ecmul_0-3_5617_28000_128
          - ecmul_0-3_5617_28000_96
          - ecmul_0-3_9935_21000_128
          - ecmul_0-3_9935_21000_96
          - ecmul_0-3_9935_28000_128
          - ecmul_0-3_9935_28000_96
          - ecmul_0-3_9_21000_128
          - ecmul_0-3_9_21000_96
          - ecmul_0-3_9_28000_128
          - ecmul_0-3_9_28000_96
          - ecmul_1-2_0_21000_128
          - ecmul_1-2_0_21000_64
          - ecmul_1-2_0_21000_80
          - ecmul_1-2_0_21000_96
          - ecmul_1-2_0_28000_128
          - ecmul_1-2_0_28000_64
          - ecmul_1-2_0_28000_80
          - ecmul_1-2_0_28000_96
          - ecmul_1-2_1_21000_128
          - ecmul_1-2_1_21000_96
          - ecmul_1-2_1_28000_128
          - ecmul_1-2_1_28000_96
          - ecmul_1-2_2_21000_128
          - ecmul_1-2_2_21000_96
          - stEIP3651-warmcoinbase
          - stEIP3855-push0
          - stEIP3860-limitmeterinitcode
          - bc4895-withdrawals
          - bcBlockGasLimitTest
          - bcEIP1559
          #65
          - bcEIP3675
          - bcForgedTest
          - bcInvalidHeaderTest
          - bcMultiChainTest
          - bcUncleHeaderValidity
          - bcUncleSpecialTests
          - bcUncleTest
          - bcArrowGlacierToMerge
          - bcBerlinToLondon
          - bcByzantiumToConstantinopleFix
          - bcEIP158ToByzantium
          - bcFrontierToHomestead
          - bcHomesteadToDao
          - bcHomesteadToEIP150
          - bcMergeToShanghai
          - bcBlockGasLimitTest
          - bcEIP1559
          - bcEIP3675
          #66
          - bcExploitTest
          #67
          - bcExample
          - bcForkStressTest
          - bcGasPricerTest
          - bcMultiChainTest
          - bcRandomBlockhashTest
          - bcStateTests
          #68
          - bcTotalDifficultyTest
          - bcUncleSpecialTests
          - bcUncleTest
          - bcValidBlockTest
          - bcWalletTest
    steps:
      - name: Set up parameters
        run: |
          echo "PARALLELISM=${{ github.event.inputs.parallelism || '3' }}" >> $GITHUB_ENV
      - name: Check out Nethermind repository
        uses: actions/checkout@v3
        with:
          path: nethermind
      - name: Set up QEMU
        uses: docker/setup-qemu-action@v2
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v2
      - name: Build Docker image
        uses: docker/build-push-action@v3
        with:
          context: nethermind
          file: nethermind/Dockerfile
          tags: nethermind:test-${{ github.sha }}
          outputs: type=docker,dest=/tmp/image.tar
      - name: Install Linux packages
        run: |
          sudo apt-get update
          sudo apt-get install libsnappy-dev libc6-dev build-essential
      - name: Set up Go environment
        uses: actions/setup-go@v4
        with:
          go-version: stable
      - name: Check out Hive repository
        uses: actions/checkout@v3
        with:
          repository: ethereum/hive
          ref: master
          path: hive
      - name: Patch Hive Dockerfile
        run: sed -i 's#FROM $baseimage:$tag#FROM nethermind:test-${{ github.sha }}#g' hive/clients/nethermind/Dockerfile
      - name: Build Hive
        working-directory: hive
        run: go build .
      - name: Load Docker image
        run: docker load --input /tmp/image.tar

      - name: Run ${{ matrix.limit }}
        continue-on-error: true
        working-directory: hive
        run: ./hive --client nethermind --sim ethereum/consensus --sim.limit ${{ matrix.limit }} #--sim.parallelism $PARALLELISM
      #- name: Upload results
      #  uses: actions/upload-artifact@v3
      #  with:
      #    name: ${{ matrix.limit }}-${{ github.run_number }}-${{ github.run_attempt }}
      #    path: hive/workspace
      #    retention-days: 7
      - name: Print results
        run: |
          rm hive/workspace/logs/hive.json
          chmod +x nethermind/scripts/hive-results.sh
          nethermind/scripts/hive-results.sh "hive/workspace/logs/*.json"
