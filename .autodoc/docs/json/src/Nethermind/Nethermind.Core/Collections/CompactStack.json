{
  "fileName": "CompactStack.cs",
  "filePath": "src/Nethermind/Nethermind.Core/Collections/CompactStack.cs",
  "url": "https://github.com/nethermindeth/nethermind/Nethermind.Core/Collections/CompactStack.cs",
  "summary": "The `CompactStack` class is a custom implementation of a stack data structure that is optimized for memory usage. It is designed to be used in the `Nethermind` project and is located in the `Nethermind.Core.Collections` namespace. \n\nThe `CompactStack` class is a generic class that takes a type parameter `T`. It consists of two nested classes: `Node` and `ObjectPoolPolicy`. The `Node` class represents a node in the stack and contains an array of type `T` and a count of the number of items in the array. The `ObjectPoolPolicy` class is an implementation of the `IPooledObjectPolicy` interface and is used to create and return instances of the `Node` class.\n\nThe `CompactStack` class uses an object pool to manage the nodes in the stack. The object pool is an instance of the `ObjectPool` class from the `Microsoft.Extensions.ObjectPool` namespace. The object pool is created with an instance of the `ObjectPoolPolicy` class, which specifies the size of the node array.\n\nThe `CompactStack` class provides two public methods: `Push` and `TryPop`. The `Push` method adds an item to the top of the stack. If the current node is full, a new node is created and added to the top of the stack. The `TryPop` method removes and returns the item at the top of the stack. If the stack is empty, it returns `false`.\n\nThe `CompactStack` class is designed to be memory-efficient by using an object pool to manage the nodes in the stack. This allows the nodes to be reused, reducing the number of allocations and deallocations. Additionally, the nodes are designed to have a fixed size, which prevents large arrays from being allocated and reduces the likelihood of large object heap (LOH) allocations. \n\nHere is an example of how to use the `CompactStack` class:\n\n```\n// Create a new CompactStack with a node size of 64\nCompactStack<int> stack = new CompactStack<int>(new DefaultObjectPool<CompactStack<int>.Node>(new CompactStack<int>.ObjectPoolPolicy(64), 1));\n\n// Push some items onto the stack\nstack.Push(1);\nstack.Push(2);\nstack.Push(3);\n\n// Pop items off the stack\nint item;\nwhile (stack.TryPop(out item))\n{\n    Console.WriteLine(item);\n}\n```",
  "questions": "1. What is the purpose of the CompactStack class?\n    \n    The CompactStack class is a linked list stack that uses an array instead of a single item to prevent allocating a large array and allow configuring the size of the node so that it will not become a LOH allocation. It also allows specifying an object pool of node to be shared between multiple stacks.\n\n2. What is the purpose of the Node class?\n    \n    The Node class is used to represent a node in the linked list stack. It contains an array of items and a count of the number of items in the array.\n\n3. What is the purpose of the ObjectPoolPolicy class?\n    \n    The ObjectPoolPolicy class is used to create and return instances of the Node class to an object pool. It also resets the count and tail of the Node instance when it is returned to the pool.",
  "checksum": "0f4b728e7be43e67d3917ad6545da767"
}